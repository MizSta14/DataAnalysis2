\documentclass[letterpaper, 12pt]{article}


\usepackage{parskip,xspace}
\usepackage{amsmath,amsthm,amsfonts,amssymb} 
\usepackage{caption}
\usepackage{xcolor} 
\usepackage{geometry}
\usepackage{fancyhdr}
\usepackage{rotating}
\usepackage{multirow}
\usepackage{makecell}
\usepackage{ltxtable}
\usepackage{hyperref}
\usepackage{graphicx}
\usepackage{subfigure}
\usepackage{bm}
\usepackage[]{statrep}
\usepackage{enumerate}
\usepackage{subfigure}
\graphicspath{{eps/}}







\pagestyle{fancy}
\lhead{Peng Shao 14221765}
\chead{}
\rhead{\bfseries STAT 8320 Spring 2015 Assignment 2}
\renewcommand{\headrulewidth}{0.4 pt}
\setlength{\parindent}{2em}

\begin{document}
\title{STAT 8320 Spring 2015 Assignment 2}
\author{Peng Shao 14221765}
\maketitle
\indent



\begin{Sascode}[store=class]
libname da2 'C:\Users\psy6b\Desktop\8320 datasets'; ods graphics on; options ls=70 ps=35; data da2.h5q2;infile 'C:\Users\psy6b\Desktop\8320 datasets\growthdata.dat';input t @;do i=1 to 6;input y @;output;end;run;data aver;set da2.h5q2;by t;retain count yave;if first.t then do;count=0;yave=0;end;count+1;yave+y;if last.t then do;y=yave/count;i=7;output;end;keep t i y;run;data da2.h5q2plot;set da2.h5q2 aver;run;proc sort data=da2.h5q2plot;by i;run;symbol interpol=join;proc gplot data=da2.h5q2plot;plot y*t=i;run;quit;proc nlmixed data=da2.h5q2;parameters beta1=200beta2=850beta3=350resvar=40varu=900;e=exp(-(t-beta2)/beta3);model y ~ normal((beta1+u)/(1+e), resvar);random u ~ normal(0,varu) subject=i out=EBlups;predict beta1/(1+e) out=pred;predict (beta1+u)/(1+e) out=predB;estimate 'Beta_3=350?' beta3-350;ods output ParameterEstimates=estimates;run;proc sort data=pred;by i t;run;proc sort data=predB;by i t;run;data panelplot;merge predB(rename=(pred=PredB)) pred;by i t;length type $20;keep i t type resp;type='measurement';resp=y;output;type='cluster-specific';resp=predb;output;type='population-average';resp=pred;output;run;proc sgpanel data=panelplot;panelby i/spacing=5 rows=2 columns=3 novarname;vline t/response=resp group=type;colaxis fitpolicy=thin alternate;rowaxis alternate;run;proc print data=eblups;title 'Estimation of Random Effect';var i Estimate tValue Probt;run;title;data da2.h5q31;infile 'C:\Users\psy6b\Desktop\8320 datasets\ssttornado532001.dat';retain ss1-ss49;array ss{49} ss1-ss49;if _N_=1 then do; input ss1-ss49;end;loc+1;drop ss1-ss49;do t=1 to 49;sst=ss{t};input torn @;output;end;run;data da2.h5q32;infile 'C:\Users\psy6b\Desktop\8320 datasets\MOtornlatlon.dat';loc+1;input lat lon;run;proc sql;create table da2.h5q3as select * from da2.h5q31 as a, da2.h5q32 as bwhere a.loc=b.loc;run;quit;proc glimmix data=da2.h5q3 noitprint;class loc;model torn = sst sst*loc / dist=poisson link=log ddfm=betwithin solution;random intercept / subject=loc type=sp(exp)(lon lat);nloptions tech=newrap;covtest 's' zerog;output out=h5q3out pred(ilink)=predicted lcl(ilink)=lower ucl(ilink)=upper pred(noblup ilink)=margpred;run;proc glimmix data=da2.h5q3 noitprint;class loc;model torn = sst sst*loc / dist=poisson link=log ddfm=betwithin solution;random intercept sst/ subject=loc type=sp(exp)(lon lat);nloptions tech=newrap;run;data panelplot2;set h5q3out;length type $20;keep loc t type resp;t=t+1952;type='measurement';resp=torn;output;type='cluster-specific';resp=predicted;output;type='lower bound';resp=lower;output;type='upper bound';resp=upper;output;run;proc sgpanel data=panelplot2;where loc le 4 and loc ge 1;panelby loc/rows=2 columns=2 spacing=5;vline t/response=resp group=type;colaxis fitpolicy=thin alternate;rowaxis alternate;run;proc sgpanel data=panelplot2;where loc le 8 and loc ge 5;panelby loc/rows=2 columns=2 spacing=5;vline t/response=resp group=type;colaxis fitpolicy=thin alternate;rowaxis alternate;run;proc sgpanel data=panelplot2;where loc le 12 and loc ge 9;panelby loc/rows=2 columns=2 spacing=5;vline t/response=resp group=type;colaxis fitpolicy=thin alternate;rowaxis alternate;run;proc sgpanel data=panelplot2;where loc le 16 and loc ge 13;panelby loc/rows=2 columns=2 spacing=5;vline t/response=resp group=type;colaxis fitpolicy=thin alternate;rowaxis alternate;run;proc sgpanel data=panelplot2;where loc le 20 and loc ge 17;panelby loc/rows=2 columns=2 spacing=5;vline t/response=resp group=type;colaxis fitpolicy=thin alternate;rowaxis alternate;run;proc sort data=h5q3out;by loc;run;data h5q3eval;set h5q3out;by loc;drop sst t;retain sumtorn summar sumpred sumu suml;if first.loc then do;sumtorn=0;summar=0;sumpred=0;sumu=0;suml=0;end;sumtorn+torn;summar+margpred;sumpred+predicted;sumu+upper;suml+lower;if last.loc then do;torn=sumtorn;margpred=summar;predicted=sumpred;upper=sumu;lower=suml;output;end;run;proc sort data=h5q3eval;by torn;run;proc sgplot data=h5q3eval noautolegend;scatter x=torn y=predicted/ datalabel=loc;series x=torn y=torn;xaxis label='Actual Measurements';yaxis label='Predicted';KEYLEGEND "Observations" "Reference Line";run;proc sgplot data=h5q3eval noautolegend;scatter x=lat y=lon/ datalabel=loc;run;\end{Sascode}


\Listing[store=class,
         caption={Regression Analysis}]{h5re}

\Graphic[store=class, scale=0.9,
         caption={Graphs for Regression Analysis}]{h5re}

\end{document}
